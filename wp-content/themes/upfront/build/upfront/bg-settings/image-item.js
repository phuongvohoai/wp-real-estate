!function(e){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["scripts/upfront/bg-settings/mixins"],function(e){var i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},e,{group:!1,initialize:function(e){var i=this,l={default_value:50,min:0,max:100,step:1},o=["bg_tile"],a=["bg_color","bg_position_x","bg_position_y","bg_position_x_num","bg_position_y_num"],n={pick_image:new Upfront.Views.Editor.Field.Button({label:t.pick_image,compact:!0,classname:"uf-button-alt uf-bgsettings-image-pick",on_click:function(){i.upload_image()}}),bg_style:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.image_type,className:"upfront-field-wrap upfront-field-wrap-select background-image-field",property:"background_style",use_breakpoint_property:!0,default_value:"full",icon_class:"upfront-region-field-icon",values:this.get_bg_style_values(),change:function(){var e=this.get_value();"tile"==e?(_.each(o,function(e){n[e].$el.show()}),_.each(a,function(e){n[e].$el.hide()})):"fixed"==e?(_.each(o,function(e){n[e].$el.hide()}),_.each(a,function(e){n[e].$el.show()})):(_.each(o,function(e){n[e].$el.hide()}),_.each(a,function(e){n[e].$el.hide()})),i._bg_style=e,i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-style")}}),bg_default:new Upfront.Views.Editor.Field.Select({model:this.model,label:t.featured_default,className:"upfront-field-wrap upfront-field-wrap-select background-image-field",property:"background_default",use_breakpoint_property:!0,default_value:"hide",icon_class:"upfront-region-field-icon",values:[{label:t.featured_default_hide,value:"hide"},{label:t.featured_default_color,value:"color"},{label:t.featured_default_image,value:"image"}],change:function(){var e=this.get_value(),t=i.model.get_breakpoint_property_value("background_image",!0);this.$el.removeClass("uf-bgsettings-image-default-image uf-bgsettings-image-default-color uf-bgsettings-image-default-hide"),"image"==e?(n.pick_image.$el.show(),n.bg_color.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-image"),t||i.upload_image()):"color"==e?(n.pick_image.$el.hide(),n.bg_color.$el.show(),this.$el.addClass("uf-bgsettings-image-default-color")):(n.pick_image.$el.hide(),n.bg_color.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-hide")),this.model.set_breakpoint_property(this.property_name,e),i.update_image()},rendered:function(){var e=this.get_saved_value();this.$el.addClass("uf-bgsettings-image-default"),"image"==e?this.$el.addClass("uf-bgsettings-image-default-image"):"color"==e?this.$el.addClass("uf-bgsettings-image-default-color"):this.$el.addClass("uf-bgsettings-image-default-hide")}}),bg_tile:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,layout:"horizontal-inline",default_value:["y","x"],values:[{label:t.tile_vertically,value:"y"},{label:t.tile_horizontally,value:"x"}],change:function(){var e=this.get_value();i._bg_tile=e,i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-tile")}}),bg_color:new Upfront.Views.Editor.Field.Color({model:this.model,label:t.bg_color_short,property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(e){i.preview_color(e)},change:function(e){i.update_color(e)},hide:function(e){i.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-image-color")}}),bg_position_y:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,label:t.image_position,orientation:"vertical",property:"background_position_y",use_breakpoint_property:!0,range:!1,change:function(){var e=this.get_value();n.bg_position_y_num.get_field().val(e),i._bg_position_y=e,this.model.set_breakpoint_property(this.property_name,e),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y")}},l)),bg_position_x:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,property:"background_position_x",use_breakpoint_property:!0,range:!1,change:function(){var e=this.get_value();n.bg_position_x_num.get_field().val(e),i._bg_position_x=e,this.model.set_breakpoint_property(this.property_name,e),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x")}},l)),bg_position_y_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"Y:",label_style:"inline",suffix:"%",change:function(){var e=this.get_value(),t=n.bg_position_y;t.$el.find("#"+t.get_field_id()).slider("value",e),t.get_field().val(e),t.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y-num")}},l)),bg_position_x_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"X:",label_style:"inline",suffix:"%",change:function(){var e=this.get_value(),t=n.bg_position_x;t.$el.find("#"+t.get_field_id()).slider("value",e),t.get_field().val(e),t.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x-num")}},l))};this.$el.addClass("uf-bgsettings-item uf-bgsettings-imageitem"),e.fields=_.map(n,function(e){return e}),this.on("show",function(){var e=i.model.get_breakpoint_property_value("background_type",!0),t=i.model.get_breakpoint_property_value("background_image",!0);i.model.get_breakpoint_property_value("background_default",!0);i._bg_style=n.bg_style.get_value(),i._bg_tile=n.bg_tile.get_value(),i._bg_position_y=n.bg_position_y.get_value(),n.bg_position_y.trigger("changed"),i._bg_position_x=n.bg_position_x.get_value(),n.bg_position_x.trigger("changed"),n.bg_style.trigger("changed"),"featured"==e?(n.bg_default.$el.show(),n.bg_default.trigger("changed")):(n.bg_default.$el.hide(),t||i.upload_image())}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)},update_image:function(){var e=this._bg_style,t=this._bg_tile,i=_.contains(t,"y"),l=_.contains(t,"x"),o=this._bg_position_y,a=this._bg_position_x;"full"==e?this.model.set_breakpoint_property("background_style","full"):"tile"==e?(this.model.set_breakpoint_property("background_style","tile"),l&&i?this.model.set_breakpoint_property("background_repeat","repeat"):i?this.model.set_breakpoint_property("background_repeat","repeat-y"):l?this.model.set_breakpoint_property("background_repeat","repeat-x"):this.model.set_breakpoint_property("background_repeat","no-repeat")):"fixed"==e?(this.model.set_breakpoint_property("background_style","fixed"),this.model.set_breakpoint_property("background_repeat","no-repeat"),this.model.set_breakpoint_property("background_position",a+"% "+o+"%")):this.model.set_breakpoint_property("background_style",e)},get_bg_style_values:function(){var e=[{label:t.full_width_bg,value:"full",icon:"bg-image-full"},{label:t.tiled_pattern,value:"tile",icon:"bg-image-tile"},{label:t.fixed_position,value:"fixed",icon:"bg-image-fixed"}];return this.model instanceof Upfront.Models.Region&&e.push({label:t.parallax,value:"parallax",icon:"bg-image-full"}),e}}));return i})}(jQuery);